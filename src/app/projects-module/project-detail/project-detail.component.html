<mat-drawer-container class="example-container" hasBackdrop="true">
<mat-drawer #drawer mode="over" position="end">
  @if(currentPieza){
    <h2>{{currentPieza.title}}</h2>
    <div class="input-drawer">
      <p>Requerido</p>
      <input type="text" [(ngModel)]="currentPieza.piezas">
    </div>
    <div class="input-drawer">
      <p>Registradas</p>
      <input type="text"[(ngModel)]="currentPieza.registrado">
    </div>
    <div class="input-drawer">
      <p>Faltantes</p>
      <input type="text" [(ngModel)]="currentPieza.faltantes">
    </div>
    <div class="input-drawer">
      <p>Rechazadas</p>
      <p>{{currentPieza.rechazadas}}</p>
      
    </div>
    <div class="input-drawer"> 
        <div></div>
         <button (click)="dialogRechazo()">Rechazar</button>
      </div>
    
   
    <h3>Comentarios</h3>
    <textarea name="" id=""></textarea>
  }
</mat-drawer>
<mat-drawer-content >
  <div class="details">
  <div class="header">
    
    <div class="project-data">
      <mat-icon (click)="goBack()">arrow_back</mat-icon>
      <h1>{{project.name}}</h1>
      <h2>{{project.noSerie}}</h2>
      <h3>{{project.user.name}}</h3>
    </div>
    <div style="display: grid;grid-template-columns: 1fr 1fr;">
      <mat-form-field style="width: 400px;">
            <mat-icon matTextPrefix>search</mat-icon>
            <mat-label>Buscar plano</mat-label>
            <input matInput placeholder="Nombre del proyecto" >
        </mat-form-field>
      <div style="display: grid;">
       <div style="display: flex;justify-content: end;gap: 1rem;">
         <button  class="main-cta" [matMenuTriggerFor]="menu">
         
          Ordenes {{orders.length}}
        </button>
        <button  class="main-cta" [disabled]="!(checked || partiallyComplete())" (click)="createOrder()">Crear orden</button>
       </div>
      </div>
    </div>
  </div>
  <div class="container">
     <table mat-table [dataSource]="dataSource" matSort>

      <ng-container matColumnDef="box">
        <th mat-header-cell *matHeaderCellDef >
          <mat-checkbox
            [(ngModel)]="checked"
            [indeterminate]="partiallyComplete()"
            (change)="checkTable()"
          >
          </mat-checkbox>
        </th>
        <td mat-cell *matCellDef="let row; let i = index"> 
            <mat-checkbox [(ngModel)]="row.checked" (change)="updateRow(row)">
          </mat-checkbox>  
        </td>
      </ng-container>
      <ng-container matColumnDef="material">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Material </th>
        <td mat-cell *matCellDef="let row"> {{row.material}} </td>
      </ng-container>
      <ng-container matColumnDef="title">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Id plano </th>
        <td mat-cell *matCellDef="let row"> {{row.title}} </td>
      </ng-container>
      <ng-container matColumnDef="acabado">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Acabado</th>
        <td mat-cell *matCellDef="let row"> {{row.acabado}} </td>
      </ng-container>
      <ng-container matColumnDef="piezas">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Requerido</th>
        <td mat-cell *matCellDef="let row"> {{row.piezas}} </td>
      </ng-container>
      <ng-container matColumnDef="registrado">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Registradas</th>
        <td mat-cell *matCellDef="let row"> {{row.registrado}} </td>
      </ng-container>
      <ng-container matColumnDef="faltantes">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Faltantes</th>
        <td mat-cell *matCellDef="let row"> {{row.faltantes}} </td>
      </ng-container>
      <ng-container matColumnDef="rechazadas">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Rechazadas</th>
        <td mat-cell *matCellDef="let row"> {{row.rechazadas}} </td>
      </ng-container>
      <ng-container matColumnDef="rechazo">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Rechazo</th>
        <td mat-cell *matCellDef="let row"> {{row.rechazo}} </td>
      </ng-container>
      <ng-container matColumnDef="comentarios">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Comentarios</th>
        <td mat-cell *matCellDef="let row"> {{row.comentarios.length}} </td>
      </ng-container>
      <ng-container matColumnDef="expand">
        <th mat-header-cell *matHeaderCellDef ></th>
        <td mat-cell *matCellDef="let row"> 
          <mat-icon (click)="toggle(row)" fontSet="material-symbols-outlined">right_panel_open</mat-icon>
         </td>
      </ng-container>

      

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

      <!-- Row shown when there is no matching data. -->
      <tr class="mat-row" *matNoDataRow>
        <td class="mat-cell" colspan="4">No data matching the filter</td>
      </tr>
    </table>
  </div>
</div>
</mat-drawer-content>
</mat-drawer-container>



<mat-menu #menu="matMenu">
  @for(order of orders;track order){
  <button mat-menu-item (click)="openOrder(order)">
     <mat-icon fontSet="material-symbols-outlined">summarize</mat-icon>
    <span>{{order.id}}</span>
  </button>
  }
</mat-menu>